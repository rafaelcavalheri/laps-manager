# Configuração de rotação de logs para o sistema LAPS
# Arquivo: /etc/logrotate.d/laps

# Logs de tentativas de login
/var/log/laps_login_attempts.json {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        # Recriar arquivo se necessário
        touch /var/log/laps_login_attempts.json
        chown www-data:www-data /var/log/laps_login_attempts.json
        chmod 644 /var/log/laps_login_attempts.json
    endscript
}

# Logs de auditoria do sistema
/var/log/laps_audit.log {
    daily
    missingok
    rotate 90
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        # Recarregar configurações se necessário
        systemctl reload apache2 2>/dev/null || true
    endscript
}

# Logs de execução de comandos
/var/log/laps_commands.log {
    daily
    missingok
    rotate 60
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
}

# Logs de erro do PHP
/var/log/php_errors.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
}

# Logs do LDAP
/var/log/ldap-up.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
}